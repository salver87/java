package webacliente;

import java.sql.Connection;
import java.sql.SQLException;
import conexion.ConexioRhuaem;
import conexion.ConexionWeb;
import java.math.BigDecimal;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.Statement;
import java.text.SimpleDateFormat;
import java.util.ArrayList;
import java.util.Date;
import java.util.List;
import java.util.Optional;
import java.util.logging.Level;
import java.util.logging.Logger;

/**
 *
 * @author Angel Carrillo V
 */
public class WebaCliente {

    static WebaCliente nominaDAO;
    private ConexioRhuaem conexionDestino;
    private ConexionWeb conexionOrigen;
    private Connection conexion;
    private Statement stm;
    private ResultSet rs;
    private PreparedStatement pre;
List<String> inserts;
    public static void main(String[] args) throws SQLException {
       
        try {
            // Crear conexión origen (usando tu clase ConexionWeb)
            ConexionWeb conexionOrigenWeb = new ConexionWeb();
            Connection connOrigen = conexionOrigenWeb.getConexion();
            
            
            // Crear DAO
             nominaDAO = new WebaCliente();
             List<GestionPolizas> registros = new ArrayList<>();
        
        registros.add(new GestionPolizas(1, "P24011040930395"));
        registros.add(new GestionPolizas(2, "P24011040931027"));
        registros.add(new GestionPolizas(3, "P24021040932893"));
        registros.add(new GestionPolizas(4, "P24021040934286"));
        registros.add(new GestionPolizas(5, "P24031040937141"));
        registros.add(new GestionPolizas(6, "P24031040938341"));
        registros.add(new GestionPolizas(7, "P24041040941359"));
        registros.add(new GestionPolizas(8, "P24041040944039"));
        registros.add(new GestionPolizas(9, "P24051040945422"));
        registros.add(new GestionPolizas(10, "P24051040949733"));
        registros.add(new GestionPolizas(11, "P24061040952038"));
        registros.add(new GestionPolizas(12, "P24061040954655"));
        registros.add(new GestionPolizas(13, "P24071040956957"));
        registros.add(new GestionPolizas(14, "P24071040958455"));
        registros.add(new GestionPolizas(15, "P24081040962771"));
        registros.add(new GestionPolizas(16, "P24081040965006"));
        registros.add(new GestionPolizas(17, "P24091040968288"));
        registros.add(new GestionPolizas(18, "P24091040970973"));
        registros.add(new GestionPolizas(19, "P24101040981918"));
        registros.add(new GestionPolizas(20, "P24101040978877"));
        registros.add(new GestionPolizas(21, "P24111040982320"));
        registros.add(new GestionPolizas(22, "P24111040985648"));
        registros.add(new GestionPolizas(23, "P24121040988885"));
        registros.add(new GestionPolizas(24, "P24121040989467"));
        registros.add(new GestionPolizas(25, "P24121040989744"));
        registros.add(new GestionPolizas(26, "P24121040989885"));
        registros.add(new GestionPolizas(27, "P24021040934338"));
        registros.add(new GestionPolizas(29, "P24071040961454"));
        registros.add(new GestionPolizas(30, "P24081040965030"));
        registros.add(new GestionPolizas(31, "P24091040970543"));
        registros.add(new GestionPolizas(32, "P24111040982774"));
        registros.add(new GestionPolizas(34, "P24111040985664"));
        registros.add(new GestionPolizas(35, "P24121040990045"));

            // Definir el query SQL como String
            for(int i=16;i<=35;i++){
               
                GestionPolizas resultado = buscarPorNumero(registros, i);
                
                if (resultado!= null) {
                     String querySql = nominaDAO.CreaQuery(i, resultado.getPoliza());
                      List<String> inserts = nominaDAO.ejecutarQueryYGenerarInserts(querySql);
                      nominaDAO.ejecutarInserts(inserts);
                } 
               
            }
        } catch (ClassNotFoundException ex) {
            Logger.getLogger(WebaCliente.class.getName()).log(Level.SEVERE, null, ex);
        }
           
    }
    
    // Método para buscar un registro por número
    public static GestionPolizas buscarPorNumero(List<GestionPolizas> registros, int numero) {
       return registros.stream()
                .filter(registro -> registro.getPeriodo() == numero)
                .findFirst()
                .orElse(null);
    }
    
   

    
    public String CreaQuery(int qna, String poliza){
        String query = "select 'ESTADO DE MEXICO' ENTIDAD,\n" +
"       DECODE(IP.NO_FUENTE,1163,'U006',1164,'EST','PARTICIPACIONES') NOM_FONDO,\n" +
"       'R15' CLAVE_DEPEN,\n" +
"       'UNIVERSIDAD AUTONOMA DEL ESTADO DE MÃ‰XICO' DEPEN,\n" +
"       AF.CLAVE_AREA CCT,\n" +
"       af.descripcion CENTRO_TRABAJO,\n" +
"       'O' TIPONOMINA, --DECODE(IP.NO_PARAMETRO,3,'H','O') TIPONOMINA, -- VERIFICAR SI SEGUIRA SIENDO IDENTIFICADA SOLO LA NOMINA DE HONORARIOS\n" +
"       'QUINCENAL' PERIODICIDAD_PAGO,\n" +
"       MIN(NVL((SELECT DF.RFC_SAT FROM DOMICILIOS_FISCALES DF WHERE DF.NO_PERSONAL = PE.NO_PERSONAL AND ROWNUM = 1),PE.RFC_ALFA||LPAD(PE.RFC_NUM,6,0)||PE.RFC_HOMO)) RFC, -- SE PUEDE CAMBIAR POR LA FUNCION UAEM_RFC(IP.NO_PERSONAL) RFC,\n" +
"       MIN(NVL((SELECT DF.CURP_SAT FROM DOMICILIOS_FISCALES DF WHERE DF.NO_PERSONAL = PE.NO_PERSONAL AND ROWNUM = 1),PE.RFC_ALFA||LPAD(PE.RFC_NUM,6,0)||PE.SEXO||pe.ESTADO_DE_NACIMIENTO||PE.CURP_CONS||PE.CURP_HOMO||PE.CURP_DIGITO)) CURP, \n" +
"       pe.afiliacion NSS,\n" +
"       PE.NOMBRE NOMBRE_EMP,\n" +
"       PE.APELLIDO_PATERNO APELLIDO_1_EMP,\n" +
"       pe.apellido_materno APELLIDO_2_EMP,\n" +
"       PE.NO_PERSONAL NUM_EMP,\n" +
"       IP.NO_POSICION PLAZA,\n" +
"       MO.DESCRIPCION TIPO_DE_PERSONAL,\n" +
"       PO.NO_PUESTO CAT_PUESTO,\n" +
"       pu.nombre CATEGORIA,\n" +
"       pu.nombre DES_PUESTO,       \n" +
"       PO.NO_PUESTO NIVEL_SALARIAL,\n" +
"       '2' ZE,\n" +
"       po.horas_trabajo HORAS,\n" +
"       CASE WHEN PE.FECHA_ANTIGUEDAD > PN.FECHA_FIN_NOMINA THEN PN.FECHA_INICIO_NOMINA \n" +
"            ELSE PE.FECHA_ANTIGUEDAD \n" +
"       END AS FECHA_ING,\n" +
"       'P' || TO_CHAR(CASE \n" +
"                         WHEN PE.FECHA_ANTIGUEDAD > PN.FECHA_FIN_NOMINA THEN PN.FECHA_INICIO_NOMINA \n" +
"                         ELSE PE.FECHA_ANTIGUEDAD \n" +
"                      END, 'YY') || 'Y' || \n" +
"               TO_CHAR(CASE \n" +
"                         WHEN PE.FECHA_ANTIGUEDAD > PN.FECHA_FIN_NOMINA THEN PN.FECHA_INICIO_NOMINA \n" +
"                         ELSE PE.FECHA_ANTIGUEDAD \n" +
"                      END, 'MM') || 'M' || \n" +
"               TO_CHAR(CASE \n" +
"                         WHEN PE.FECHA_ANTIGUEDAD > PN.FECHA_FIN_NOMINA THEN PN.FECHA_INICIO_NOMINA \n" +
"                         ELSE PE.FECHA_ANTIGUEDAD \n" +
"                      END, 'DD') AS ANTIG,\n" +
"      -- round((SUM(DECODE(IP.NO_CONCEPTO,39,IP.IMPORTE,0))*100)/decode(case when rh_uaemex.M_GENERAL.GN_INFORMA_POSICION(po.NO_POSICION,16)=0  THEN M_GENERAL.GN_TABULADOR(1,PO.NO_PUESTO,1,1,2,'01/01/1990') / 2 ELSE rh_uaemex.M_GENERAL.GN_INFORMA_POSICION(po.NO_POSICION,16) END,0,1,case when rh_uaemex.M_GENERAL.GN_INFORMA_POSICION(po.NO_POSICION,16)=0  THEN M_GENERAL.GN_TABULADOR(1,PO.NO_PUESTO,1,1,2,'01/01/1990') / 2 ELSE rh_uaemex.M_GENERAL.GN_INFORMA_POSICION(po.NO_POSICION,16) END),1)  N_QUINQ, -- no quinquenios a los que tiene derecho\n" +
"       CASE WHEN round((SUM(DECODE(IP.NO_CONCEPTO,39,IP.IMPORTE,0))*100)/decode(case when rh_uaemex.M_GENERAL.GN_INFORMA_POSICION(po.NO_POSICION,16)=0  THEN M_GENERAL.GN_TABULADOR(1,PO.NO_PUESTO,1,1,2,'01/01/1990') / 2 ELSE rh_uaemex.M_GENERAL.GN_INFORMA_POSICION(po.NO_POSICION,16) END,0,1,case when rh_uaemex.M_GENERAL.GN_INFORMA_POSICION(po.NO_POSICION,16)=0  THEN M_GENERAL.GN_TABULADOR(1,PO.NO_PUESTO,1,1,2,'01/01/1990') / 2 ELSE rh_uaemex.M_GENERAL.GN_INFORMA_POSICION(po.NO_POSICION,16) END),1) = 0 THEN 0\n" +
"       WHEN round((SUM(DECODE(IP.NO_CONCEPTO,39,IP.IMPORTE,0))*100)/decode(case when rh_uaemex.M_GENERAL.GN_INFORMA_POSICION(po.NO_POSICION,16)=0  THEN M_GENERAL.GN_TABULADOR(1,PO.NO_PUESTO,1,1,2,'01/01/1990') / 2 ELSE rh_uaemex.M_GENERAL.GN_INFORMA_POSICION(po.NO_POSICION,16) END,0,1,case when rh_uaemex.M_GENERAL.GN_INFORMA_POSICION(po.NO_POSICION,16)=0  THEN M_GENERAL.GN_TABULADOR(1,PO.NO_PUESTO,1,1,2,'01/01/1990') / 2 ELSE rh_uaemex.M_GENERAL.GN_INFORMA_POSICION(po.NO_POSICION,16) END),1) = 2 THEN 4\n" +
"       WHEN round((SUM(DECODE(IP.NO_CONCEPTO,39,IP.IMPORTE,0))*100)/decode(case when rh_uaemex.M_GENERAL.GN_INFORMA_POSICION(po.NO_POSICION,16)=0  THEN M_GENERAL.GN_TABULADOR(1,PO.NO_PUESTO,1,1,2,'01/01/1990') / 2 ELSE rh_uaemex.M_GENERAL.GN_INFORMA_POSICION(po.NO_POSICION,16) END,0,1,case when rh_uaemex.M_GENERAL.GN_INFORMA_POSICION(po.NO_POSICION,16)=0  THEN M_GENERAL.GN_TABULADOR(1,PO.NO_PUESTO,1,1,2,'01/01/1990') / 2 ELSE rh_uaemex.M_GENERAL.GN_INFORMA_POSICION(po.NO_POSICION,16) END),1) = 3 THEN 5\n" +
"       WHEN round((SUM(DECODE(IP.NO_CONCEPTO,39,IP.IMPORTE,0))*100)/decode(case when rh_uaemex.M_GENERAL.GN_INFORMA_POSICION(po.NO_POSICION,16)=0  THEN M_GENERAL.GN_TABULADOR(1,PO.NO_PUESTO,1,1,2,'01/01/1990') / 2 ELSE rh_uaemex.M_GENERAL.GN_INFORMA_POSICION(po.NO_POSICION,16) END,0,1,case when rh_uaemex.M_GENERAL.GN_INFORMA_POSICION(po.NO_POSICION,16)=0  THEN M_GENERAL.GN_TABULADOR(1,PO.NO_PUESTO,1,1,2,'01/01/1990') / 2 ELSE rh_uaemex.M_GENERAL.GN_INFORMA_POSICION(po.NO_POSICION,16) END),1) = 4 THEN 6\n" +
"       WHEN round((SUM(DECODE(IP.NO_CONCEPTO,39,IP.IMPORTE,0))*100)/decode(case when rh_uaemex.M_GENERAL.GN_INFORMA_POSICION(po.NO_POSICION,16)=0  THEN M_GENERAL.GN_TABULADOR(1,PO.NO_PUESTO,1,1,2,'01/01/1990') / 2 ELSE rh_uaemex.M_GENERAL.GN_INFORMA_POSICION(po.NO_POSICION,16) END,0,1,case when rh_uaemex.M_GENERAL.GN_INFORMA_POSICION(po.NO_POSICION,16)=0  THEN M_GENERAL.GN_TABULADOR(1,PO.NO_PUESTO,1,1,2,'01/01/1990') / 2 ELSE rh_uaemex.M_GENERAL.GN_INFORMA_POSICION(po.NO_POSICION,16) END),1) = 6.5 THEN 7\n" +
"       WHEN round((SUM(DECODE(IP.NO_CONCEPTO,39,IP.IMPORTE,0))*100)/decode(case when rh_uaemex.M_GENERAL.GN_INFORMA_POSICION(po.NO_POSICION,16)=0  THEN M_GENERAL.GN_TABULADOR(1,PO.NO_PUESTO,1,1,2,'01/01/1990') / 2 ELSE rh_uaemex.M_GENERAL.GN_INFORMA_POSICION(po.NO_POSICION,16) END,0,1,case when rh_uaemex.M_GENERAL.GN_INFORMA_POSICION(po.NO_POSICION,16)=0  THEN M_GENERAL.GN_TABULADOR(1,PO.NO_PUESTO,1,1,2,'01/01/1990') / 2 ELSE rh_uaemex.M_GENERAL.GN_INFORMA_POSICION(po.NO_POSICION,16) END),1) = 8 THEN 8\n" +
"       WHEN round((SUM(DECODE(IP.NO_CONCEPTO,39,IP.IMPORTE,0))*100)/decode(case when rh_uaemex.M_GENERAL.GN_INFORMA_POSICION(po.NO_POSICION,16)=0  THEN M_GENERAL.GN_TABULADOR(1,PO.NO_PUESTO,1,1,2,'01/01/1990') / 2 ELSE rh_uaemex.M_GENERAL.GN_INFORMA_POSICION(po.NO_POSICION,16) END,0,1,case when rh_uaemex.M_GENERAL.GN_INFORMA_POSICION(po.NO_POSICION,16)=0  THEN M_GENERAL.GN_TABULADOR(1,PO.NO_PUESTO,1,1,2,'01/01/1990') / 2 ELSE rh_uaemex.M_GENERAL.GN_INFORMA_POSICION(po.NO_POSICION,16) END),1) = 9.5 THEN 9\n" +
"       WHEN round((SUM(DECODE(IP.NO_CONCEPTO,39,IP.IMPORTE,0))*100)/decode(case when rh_uaemex.M_GENERAL.GN_INFORMA_POSICION(po.NO_POSICION,16)=0  THEN M_GENERAL.GN_TABULADOR(1,PO.NO_PUESTO,1,1,2,'01/01/1990') / 2 ELSE rh_uaemex.M_GENERAL.GN_INFORMA_POSICION(po.NO_POSICION,16) END,0,1,case when rh_uaemex.M_GENERAL.GN_INFORMA_POSICION(po.NO_POSICION,16)=0  THEN M_GENERAL.GN_TABULADOR(1,PO.NO_PUESTO,1,1,2,'01/01/1990') / 2 ELSE rh_uaemex.M_GENERAL.GN_INFORMA_POSICION(po.NO_POSICION,16) END),1) = 11 THEN 10\n" +
"       WHEN round((SUM(DECODE(IP.NO_CONCEPTO,39,IP.IMPORTE,0))*100)/decode(case when rh_uaemex.M_GENERAL.GN_INFORMA_POSICION(po.NO_POSICION,16)=0  THEN M_GENERAL.GN_TABULADOR(1,PO.NO_PUESTO,1,1,2,'01/01/1990') / 2 ELSE rh_uaemex.M_GENERAL.GN_INFORMA_POSICION(po.NO_POSICION,16) END,0,1,case when rh_uaemex.M_GENERAL.GN_INFORMA_POSICION(po.NO_POSICION,16)=0  THEN M_GENERAL.GN_TABULADOR(1,PO.NO_PUESTO,1,1,2,'01/01/1990') / 2 ELSE rh_uaemex.M_GENERAL.GN_INFORMA_POSICION(po.NO_POSICION,16) END),1) = 12.5 THEN 11\n" +
"       WHEN round((SUM(DECODE(IP.NO_CONCEPTO,39,IP.IMPORTE,0))*100)/decode(case when rh_uaemex.M_GENERAL.GN_INFORMA_POSICION(po.NO_POSICION,16)=0  THEN M_GENERAL.GN_TABULADOR(1,PO.NO_PUESTO,1,1,2,'01/01/1990') / 2 ELSE rh_uaemex.M_GENERAL.GN_INFORMA_POSICION(po.NO_POSICION,16) END,0,1,case when rh_uaemex.M_GENERAL.GN_INFORMA_POSICION(po.NO_POSICION,16)=0  THEN M_GENERAL.GN_TABULADOR(1,PO.NO_PUESTO,1,1,2,'01/01/1990') / 2 ELSE rh_uaemex.M_GENERAL.GN_INFORMA_POSICION(po.NO_POSICION,16) END),1) = 14 THEN 12\n" +
"       WHEN round((SUM(DECODE(IP.NO_CONCEPTO,39,IP.IMPORTE,0))*100)/decode(case when rh_uaemex.M_GENERAL.GN_INFORMA_POSICION(po.NO_POSICION,16)=0  THEN M_GENERAL.GN_TABULADOR(1,PO.NO_PUESTO,1,1,2,'01/01/1990') / 2 ELSE rh_uaemex.M_GENERAL.GN_INFORMA_POSICION(po.NO_POSICION,16) END,0,1,case when rh_uaemex.M_GENERAL.GN_INFORMA_POSICION(po.NO_POSICION,16)=0  THEN M_GENERAL.GN_TABULADOR(1,PO.NO_PUESTO,1,1,2,'01/01/1990') / 2 ELSE rh_uaemex.M_GENERAL.GN_INFORMA_POSICION(po.NO_POSICION,16) END),1) = 15.5 THEN 13\n" +
"       WHEN round((SUM(DECODE(IP.NO_CONCEPTO,39,IP.IMPORTE,0))*100)/decode(case when rh_uaemex.M_GENERAL.GN_INFORMA_POSICION(po.NO_POSICION,16)=0  THEN M_GENERAL.GN_TABULADOR(1,PO.NO_PUESTO,1,1,2,'01/01/1990') / 2 ELSE rh_uaemex.M_GENERAL.GN_INFORMA_POSICION(po.NO_POSICION,16) END,0,1,case when rh_uaemex.M_GENERAL.GN_INFORMA_POSICION(po.NO_POSICION,16)=0  THEN M_GENERAL.GN_TABULADOR(1,PO.NO_PUESTO,1,1,2,'01/01/1990') / 2 ELSE rh_uaemex.M_GENERAL.GN_INFORMA_POSICION(po.NO_POSICION,16) END),1) = 17 THEN 14\n" +
"       WHEN round((SUM(DECODE(IP.NO_CONCEPTO,39,IP.IMPORTE,0))*100)/decode(case when rh_uaemex.M_GENERAL.GN_INFORMA_POSICION(po.NO_POSICION,16)=0  THEN M_GENERAL.GN_TABULADOR(1,PO.NO_PUESTO,1,1,2,'01/01/1990') / 2 ELSE rh_uaemex.M_GENERAL.GN_INFORMA_POSICION(po.NO_POSICION,16) END,0,1,case when rh_uaemex.M_GENERAL.GN_INFORMA_POSICION(po.NO_POSICION,16)=0  THEN M_GENERAL.GN_TABULADOR(1,PO.NO_PUESTO,1,1,2,'01/01/1990') / 2 ELSE rh_uaemex.M_GENERAL.GN_INFORMA_POSICION(po.NO_POSICION,16) END),1) = 18.5 THEN 15\n" +
"       WHEN round((SUM(DECODE(IP.NO_CONCEPTO,39,IP.IMPORTE,0))*100)/decode(case when rh_uaemex.M_GENERAL.GN_INFORMA_POSICION(po.NO_POSICION,16)=0  THEN M_GENERAL.GN_TABULADOR(1,PO.NO_PUESTO,1,1,2,'01/01/1990') / 2 ELSE rh_uaemex.M_GENERAL.GN_INFORMA_POSICION(po.NO_POSICION,16) END,0,1,case when rh_uaemex.M_GENERAL.GN_INFORMA_POSICION(po.NO_POSICION,16)=0  THEN M_GENERAL.GN_TABULADOR(1,PO.NO_PUESTO,1,1,2,'01/01/1990') / 2 ELSE rh_uaemex.M_GENERAL.GN_INFORMA_POSICION(po.NO_POSICION,16) END),1) = 20 THEN 16\n" +
"       WHEN round((SUM(DECODE(IP.NO_CONCEPTO,39,IP.IMPORTE,0))*100)/decode(case when rh_uaemex.M_GENERAL.GN_INFORMA_POSICION(po.NO_POSICION,16)=0  THEN M_GENERAL.GN_TABULADOR(1,PO.NO_PUESTO,1,1,2,'01/01/1990') / 2 ELSE rh_uaemex.M_GENERAL.GN_INFORMA_POSICION(po.NO_POSICION,16) END,0,1,case when rh_uaemex.M_GENERAL.GN_INFORMA_POSICION(po.NO_POSICION,16)=0  THEN M_GENERAL.GN_TABULADOR(1,PO.NO_PUESTO,1,1,2,'01/01/1990') / 2 ELSE rh_uaemex.M_GENERAL.GN_INFORMA_POSICION(po.NO_POSICION,16) END),1) = 21.5 THEN 17\n" +
"       WHEN round((SUM(DECODE(IP.NO_CONCEPTO,39,IP.IMPORTE,0))*100)/decode(case when rh_uaemex.M_GENERAL.GN_INFORMA_POSICION(po.NO_POSICION,16)=0  THEN M_GENERAL.GN_TABULADOR(1,PO.NO_PUESTO,1,1,2,'01/01/1990') / 2 ELSE rh_uaemex.M_GENERAL.GN_INFORMA_POSICION(po.NO_POSICION,16) END,0,1,case when rh_uaemex.M_GENERAL.GN_INFORMA_POSICION(po.NO_POSICION,16)=0  THEN M_GENERAL.GN_TABULADOR(1,PO.NO_PUESTO,1,1,2,'01/01/1990') / 2 ELSE rh_uaemex.M_GENERAL.GN_INFORMA_POSICION(po.NO_POSICION,16) END),1) = 23 THEN 18\n" +
"       WHEN round((SUM(DECODE(IP.NO_CONCEPTO,39,IP.IMPORTE,0))*100)/decode(case when rh_uaemex.M_GENERAL.GN_INFORMA_POSICION(po.NO_POSICION,16)=0  THEN M_GENERAL.GN_TABULADOR(1,PO.NO_PUESTO,1,1,2,'01/01/1990') / 2 ELSE rh_uaemex.M_GENERAL.GN_INFORMA_POSICION(po.NO_POSICION,16) END,0,1,case when rh_uaemex.M_GENERAL.GN_INFORMA_POSICION(po.NO_POSICION,16)=0  THEN M_GENERAL.GN_TABULADOR(1,PO.NO_PUESTO,1,1,2,'01/01/1990') / 2 ELSE rh_uaemex.M_GENERAL.GN_INFORMA_POSICION(po.NO_POSICION,16) END),1) = 24.5 THEN 19\n" +
"       WHEN round((SUM(DECODE(IP.NO_CONCEPTO,39,IP.IMPORTE,0))*100)/decode(case when rh_uaemex.M_GENERAL.GN_INFORMA_POSICION(po.NO_POSICION,16)=0  THEN M_GENERAL.GN_TABULADOR(1,PO.NO_PUESTO,1,1,2,'01/01/1990') / 2 ELSE rh_uaemex.M_GENERAL.GN_INFORMA_POSICION(po.NO_POSICION,16) END,0,1,case when rh_uaemex.M_GENERAL.GN_INFORMA_POSICION(po.NO_POSICION,16)=0  THEN M_GENERAL.GN_TABULADOR(1,PO.NO_PUESTO,1,1,2,'01/01/1990') / 2 ELSE rh_uaemex.M_GENERAL.GN_INFORMA_POSICION(po.NO_POSICION,16) END),1) = 26 THEN 20\n" +
"       WHEN round((SUM(DECODE(IP.NO_CONCEPTO,39,IP.IMPORTE,0))*100)/decode(case when rh_uaemex.M_GENERAL.GN_INFORMA_POSICION(po.NO_POSICION,16)=0  THEN M_GENERAL.GN_TABULADOR(1,PO.NO_PUESTO,1,1,2,'01/01/1990') / 2 ELSE rh_uaemex.M_GENERAL.GN_INFORMA_POSICION(po.NO_POSICION,16) END,0,1,case when rh_uaemex.M_GENERAL.GN_INFORMA_POSICION(po.NO_POSICION,16)=0  THEN M_GENERAL.GN_TABULADOR(1,PO.NO_PUESTO,1,1,2,'01/01/1990') / 2 ELSE rh_uaemex.M_GENERAL.GN_INFORMA_POSICION(po.NO_POSICION,16) END),1) = 27.5 THEN 21\n" +
"       WHEN round((SUM(DECODE(IP.NO_CONCEPTO,39,IP.IMPORTE,0))*100)/decode(case when rh_uaemex.M_GENERAL.GN_INFORMA_POSICION(po.NO_POSICION,16)=0  THEN M_GENERAL.GN_TABULADOR(1,PO.NO_PUESTO,1,1,2,'01/01/1990') / 2 ELSE rh_uaemex.M_GENERAL.GN_INFORMA_POSICION(po.NO_POSICION,16) END,0,1,case when rh_uaemex.M_GENERAL.GN_INFORMA_POSICION(po.NO_POSICION,16)=0  THEN M_GENERAL.GN_TABULADOR(1,PO.NO_PUESTO,1,1,2,'01/01/1990') / 2 ELSE rh_uaemex.M_GENERAL.GN_INFORMA_POSICION(po.NO_POSICION,16) END),1) = 29 THEN 22\n" +
"       WHEN round((SUM(DECODE(IP.NO_CONCEPTO,39,IP.IMPORTE,0))*100)/decode(case when rh_uaemex.M_GENERAL.GN_INFORMA_POSICION(po.NO_POSICION,16)=0  THEN M_GENERAL.GN_TABULADOR(1,PO.NO_PUESTO,1,1,2,'01/01/1990') / 2 ELSE rh_uaemex.M_GENERAL.GN_INFORMA_POSICION(po.NO_POSICION,16) END,0,1,case when rh_uaemex.M_GENERAL.GN_INFORMA_POSICION(po.NO_POSICION,16)=0  THEN M_GENERAL.GN_TABULADOR(1,PO.NO_PUESTO,1,1,2,'01/01/1990') / 2 ELSE rh_uaemex.M_GENERAL.GN_INFORMA_POSICION(po.NO_POSICION,16) END),1) = 30.5 THEN 23\n" +
"       WHEN round((SUM(DECODE(IP.NO_CONCEPTO,39,IP.IMPORTE,0))*100)/decode(case when rh_uaemex.M_GENERAL.GN_INFORMA_POSICION(po.NO_POSICION,16)=0  THEN M_GENERAL.GN_TABULADOR(1,PO.NO_PUESTO,1,1,2,'01/01/1990') / 2 ELSE rh_uaemex.M_GENERAL.GN_INFORMA_POSICION(po.NO_POSICION,16) END,0,1,case when rh_uaemex.M_GENERAL.GN_INFORMA_POSICION(po.NO_POSICION,16)=0  THEN M_GENERAL.GN_TABULADOR(1,PO.NO_PUESTO,1,1,2,'01/01/1990') / 2 ELSE rh_uaemex.M_GENERAL.GN_INFORMA_POSICION(po.NO_POSICION,16) END),1) = 32 THEN 24\n" +
"       WHEN round((SUM(DECODE(IP.NO_CONCEPTO,39,IP.IMPORTE,0))*100)/decode(case when rh_uaemex.M_GENERAL.GN_INFORMA_POSICION(po.NO_POSICION,16)=0  THEN M_GENERAL.GN_TABULADOR(1,PO.NO_PUESTO,1,1,2,'01/01/1990') / 2 ELSE rh_uaemex.M_GENERAL.GN_INFORMA_POSICION(po.NO_POSICION,16) END,0,1,case when rh_uaemex.M_GENERAL.GN_INFORMA_POSICION(po.NO_POSICION,16)=0  THEN M_GENERAL.GN_TABULADOR(1,PO.NO_PUESTO,1,1,2,'01/01/1990') / 2 ELSE rh_uaemex.M_GENERAL.GN_INFORMA_POSICION(po.NO_POSICION,16) END),1) = 33.5 THEN 25\n" +
"       WHEN round((SUM(DECODE(IP.NO_CONCEPTO,39,IP.IMPORTE,0))*100)/decode(case when rh_uaemex.M_GENERAL.GN_INFORMA_POSICION(po.NO_POSICION,16)=0  THEN M_GENERAL.GN_TABULADOR(1,PO.NO_PUESTO,1,1,2,'01/01/1990') / 2 ELSE rh_uaemex.M_GENERAL.GN_INFORMA_POSICION(po.NO_POSICION,16) END,0,1,case when rh_uaemex.M_GENERAL.GN_INFORMA_POSICION(po.NO_POSICION,16)=0  THEN M_GENERAL.GN_TABULADOR(1,PO.NO_PUESTO,1,1,2,'01/01/1990') / 2 ELSE rh_uaemex.M_GENERAL.GN_INFORMA_POSICION(po.NO_POSICION,16) END),1) = 35 THEN 26\n" +
"       WHEN round((SUM(DECODE(IP.NO_CONCEPTO,39,IP.IMPORTE,0))*100)/decode(case when rh_uaemex.M_GENERAL.GN_INFORMA_POSICION(po.NO_POSICION,16)=0  THEN M_GENERAL.GN_TABULADOR(1,PO.NO_PUESTO,1,1,2,'01/01/1990') / 2 ELSE rh_uaemex.M_GENERAL.GN_INFORMA_POSICION(po.NO_POSICION,16) END,0,1,case when rh_uaemex.M_GENERAL.GN_INFORMA_POSICION(po.NO_POSICION,16)=0  THEN M_GENERAL.GN_TABULADOR(1,PO.NO_PUESTO,1,1,2,'01/01/1990') / 2 ELSE rh_uaemex.M_GENERAL.GN_INFORMA_POSICION(po.NO_POSICION,16) END),1) = 36.5 THEN 27\n" +
"       WHEN round((SUM(DECODE(IP.NO_CONCEPTO,39,IP.IMPORTE,0))*100)/decode(case when rh_uaemex.M_GENERAL.GN_INFORMA_POSICION(po.NO_POSICION,16)=0  THEN M_GENERAL.GN_TABULADOR(1,PO.NO_PUESTO,1,1,2,'01/01/1990') / 2 ELSE rh_uaemex.M_GENERAL.GN_INFORMA_POSICION(po.NO_POSICION,16) END,0,1,case when rh_uaemex.M_GENERAL.GN_INFORMA_POSICION(po.NO_POSICION,16)=0  THEN M_GENERAL.GN_TABULADOR(1,PO.NO_PUESTO,1,1,2,'01/01/1990') / 2 ELSE rh_uaemex.M_GENERAL.GN_INFORMA_POSICION(po.NO_POSICION,16) END),1) = 38 THEN 28\n" +
"       WHEN round((SUM(DECODE(IP.NO_CONCEPTO,39,IP.IMPORTE,0))*100)/decode(case when rh_uaemex.M_GENERAL.GN_INFORMA_POSICION(po.NO_POSICION,16)=0  THEN M_GENERAL.GN_TABULADOR(1,PO.NO_PUESTO,1,1,2,'01/01/1990') / 2 ELSE rh_uaemex.M_GENERAL.GN_INFORMA_POSICION(po.NO_POSICION,16) END,0,1,case when rh_uaemex.M_GENERAL.GN_INFORMA_POSICION(po.NO_POSICION,16)=0  THEN M_GENERAL.GN_TABULADOR(1,PO.NO_PUESTO,1,1,2,'01/01/1990') / 2 ELSE rh_uaemex.M_GENERAL.GN_INFORMA_POSICION(po.NO_POSICION,16) END),1) = 39.5 THEN 29\n" +
"       WHEN round((SUM(DECODE(IP.NO_CONCEPTO,39,IP.IMPORTE,0))*100)/decode(case when rh_uaemex.M_GENERAL.GN_INFORMA_POSICION(po.NO_POSICION,16)=0  THEN M_GENERAL.GN_TABULADOR(1,PO.NO_PUESTO,1,1,2,'01/01/1990') / 2 ELSE rh_uaemex.M_GENERAL.GN_INFORMA_POSICION(po.NO_POSICION,16) END,0,1,case when rh_uaemex.M_GENERAL.GN_INFORMA_POSICION(po.NO_POSICION,16)=0  THEN M_GENERAL.GN_TABULADOR(1,PO.NO_PUESTO,1,1,2,'01/01/1990') / 2 ELSE rh_uaemex.M_GENERAL.GN_INFORMA_POSICION(po.NO_POSICION,16) END),1) = 41 THEN 30\n" +
"       WHEN round((SUM(DECODE(IP.NO_CONCEPTO,39,IP.IMPORTE,0))*100)/decode(case when rh_uaemex.M_GENERAL.GN_INFORMA_POSICION(po.NO_POSICION,16)=0  THEN M_GENERAL.GN_TABULADOR(1,PO.NO_PUESTO,1,1,2,'01/01/1990') / 2 ELSE rh_uaemex.M_GENERAL.GN_INFORMA_POSICION(po.NO_POSICION,16) END,0,1,case when rh_uaemex.M_GENERAL.GN_INFORMA_POSICION(po.NO_POSICION,16)=0  THEN M_GENERAL.GN_TABULADOR(1,PO.NO_PUESTO,1,1,2,'01/01/1990') / 2 ELSE rh_uaemex.M_GENERAL.GN_INFORMA_POSICION(po.NO_POSICION,16) END),1) = 42.5 THEN 31\n" +
"       WHEN round((SUM(DECODE(IP.NO_CONCEPTO,39,IP.IMPORTE,0))*100)/decode(case when rh_uaemex.M_GENERAL.GN_INFORMA_POSICION(po.NO_POSICION,16)=0  THEN M_GENERAL.GN_TABULADOR(1,PO.NO_PUESTO,1,1,2,'01/01/1990') / 2 ELSE rh_uaemex.M_GENERAL.GN_INFORMA_POSICION(po.NO_POSICION,16) END,0,1,case when rh_uaemex.M_GENERAL.GN_INFORMA_POSICION(po.NO_POSICION,16)=0  THEN M_GENERAL.GN_TABULADOR(1,PO.NO_PUESTO,1,1,2,'01/01/1990') / 2 ELSE rh_uaemex.M_GENERAL.GN_INFORMA_POSICION(po.NO_POSICION,16) END),1) = 44 THEN 32\n" +
" ELSE 0\n" +
" END AS N_QUINQ,   \n" +
"       pn.FECHA_INICIO_NOMINA FECHA_INI,\n" +
"       pn.FECHA_FIN_NOMINA FECHA_FIN,\n" +
"       pn.FECHA_PAGO FECHA_PROC,\n" +
"       ip.ejercicio||lpad(ip.no_proceso,2,'0') PERIODO_INI,\n" +
"       ip.ejercicio||lpad(ip.no_proceso,2,'0')  PERIODO_FIN,\n" +
"       ip.ejercicio||lpad(ip.no_proceso,2,'0')  PERIODO_proc,\n" +
"       decode(ip.no_proceso,4,14,15) DIAS_PAG,\n" +
"       DECODE(CB.TIPO_DE_PAGO,2,'EL','CH') TIPO_PAGO,\n" +
"       CB.NO_CHEQUE NUM_CHEQUE_TRANSF,\n" +
"       CB.NO_CUENTA_ORG NUM_CTA_PAG,\n" +
"       DECODE(CB.NO_BANCO,1,'014',2,'002',3,'072','OTRO') CVE_BANCO_PAG, \n" +
"       DECODE(CB.NO_BANCO,1,'SANTANDER',2,'BANAMEX',3,'BANORTE','OTRO') NOM_BANCO_PAG,\n" +
"       CB.NO_CUENTA NUM_CTA_EMP,\n" +
"       DECODE(CB.NO_BANCO,1,'014',2,'002',3,'072','OTRO') CVE_BANCO_EMP,\n" +
"       DECODE(CB.NO_BANCO,1,'SANTANDER',2,'BANAMEX',3,'BANORTE','OTRO') NOM_BANCO_EMP,\n" +
"       IP.NO_FUENTE ORIGEN_RECURSO,\n" +
"       CB.UUID UUID,\n" +
"       SUM(DECODE(CO.MODO,'PEC',IP.IMPORTE,0)) T_PERCCHEQ,\n" +
"       SUM(DECODE(CO.MODO,'DED',IP.IMPORTE,0)) T_DEDCHEQ,\n" +
"       SUM(DECODE(CO.MODO,'PEC',IP.IMPORTE,0))-SUM(DECODE(CO.MODO,'DED',IP.IMPORTE,0)) T_NETOCHEQ,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,601,IP.IMPORTE,0)) PEC_101,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,109,IP.IMPORTE,0)) PEC_109,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,110,IP.IMPORTE,0)) PEC_110,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,802,IP.IMPORTE,0)) PEC_600,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,727,IP.IMPORTE,0)) PEC_727,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,757,IP.IMPORTE,0)) PEC_757,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,610,IP.IMPORTE,0)) PEC_1030,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,1,IP.IMPORTE,0)) PEC_1400,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,2,IP.IMPORTE,0)) PEC_1500,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,612,IP.IMPORTE,0)) PEC_1601,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,613,IP.IMPORTE,0)) PEC_1602,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,614,IP.IMPORTE,0)) PEC_1603,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,618,IP.IMPORTE,0)) PEC_1608,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,619,IP.IMPORTE,0)) PEC_1609,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,620,IP.IMPORTE,0)) PEC_1610,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,805,IP.IMPORTE,0)) PEC_1700,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,806,IP.IMPORTE,0)) PEC_1701,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,621,IP.IMPORTE,0)) PEC_1704,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,809,IP.IMPORTE,0)) PEC_1705,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,810,IP.IMPORTE,0)) PEC_1706,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,4,IP.IMPORTE,0)) PEC_1800,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,624,IP.IMPORTE,0)) PEC_1803,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,625,IP.IMPORTE,0)) PEC_1804,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,6,IP.IMPORTE,0)) PEC_1805,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,7,IP.IMPORTE,0)) PEC_1806,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,8,IP.IMPORTE,0)) PEC_1807,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,627,IP.IMPORTE,0)) PEC_1810,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,10,IP.IMPORTE,0)) PEC_1811,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,629,IP.IMPORTE,0)) PEC_1900,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,11,IP.IMPORTE,0)) PEC_1910,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,12,IP.IMPORTE,0)) PEC_1930,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,13,IP.IMPORTE,0)) PEC_1931,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,632,IP.IMPORTE,0)) PEC_1932,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,633,IP.IMPORTE,0)) PEC_1933,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,15,IP.IMPORTE,0)) PEC_2000,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,637,IP.IMPORTE,0)) PEC_2020,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,812,IP.IMPORTE,0)) PEC_2100,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,813,IP.IMPORTE,0)) PEC_2110,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,639,IP.IMPORTE,0)) PEC_2210,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,640,IP.IMPORTE,0)) PEC_2211,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,641,IP.IMPORTE,0)) PEC_2220,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,108,IP.IMPORTE,0)) PEC_2240,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,645,IP.IMPORTE,0)) PEC_2310,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,646,IP.IMPORTE,0)) PEC_2312,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,647,IP.IMPORTE,0)) PEC_2320,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,655,IP.IMPORTE,0)) PEC_2800,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,656,IP.IMPORTE,0)) PEC_2810,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,657,IP.IMPORTE,0)) PEC_2811,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,659,IP.IMPORTE,0)) PEC_2813,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,660,IP.IMPORTE,0)) PEC_2815,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,662,IP.IMPORTE,0)) PEC_2820,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,663,IP.IMPORTE,0)) PEC_2821,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,664,IP.IMPORTE,0)) PEC_2823,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,665,IP.IMPORTE,0)) PEC_2825,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,666,IP.IMPORTE,0)) PEC_2830,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,667,IP.IMPORTE,0)) PEC_2831,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,668,IP.IMPORTE,0)) PEC_2833,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,669,IP.IMPORTE,0)) PEC_2835,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,670,IP.IMPORTE,0)) PEC_2836,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,671,IP.IMPORTE,0)) PEC_2837,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,672,IP.IMPORTE,0)) PEC_2838,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,673,IP.IMPORTE,0)) PEC_2839,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,674,IP.IMPORTE,0)) PEC_2840,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,675,IP.IMPORTE,0)) PEC_2842,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,600,IP.IMPORTE,0)) PEC_2843,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,19,IP.IMPORTE,0)) PEC_2900,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,21,IP.IMPORTE,0)) PEC_3600,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,22,IP.IMPORTE,0)) PEC_3602,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,23,IP.IMPORTE,0)) PEC_3700,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,24,IP.IMPORTE,0)) PEC_3720,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,690,IP.IMPORTE,0)) PEC_4301,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,26,IP.IMPORTE,0)) PEC_4400,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,27,IP.IMPORTE,0)) PEC_4410,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,28,IP.IMPORTE,0)) PEC_4500,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,29,IP.IMPORTE,0)) PEC_4600,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,31,IP.IMPORTE,0)) PEC_4900,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,32,IP.IMPORTE,0)) PEC_5100,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,33,IP.IMPORTE,0)) PEC_5200,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,35,IP.IMPORTE,0)) PEC_5300,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,814,IP.IMPORTE,0)) PEC_5800,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,36,IP.IMPORTE,0)) PEC_5900,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,700,IP.IMPORTE,0)) PEC_5901,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,37,IP.IMPORTE,0)) PEC_6100,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,38,IP.IMPORTE,0)) PEC_6102,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,702,IP.IMPORTE,0)) PEC_6103,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,39,IP.IMPORTE,0)) PEC_6300,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,41,IP.IMPORTE,0)) PEC_6410,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,42,IP.IMPORTE,0)) PEC_6420,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,43,IP.IMPORTE,0)) PEC_6700,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,706,IP.IMPORTE,0)) PEC_6701,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,44,IP.IMPORTE,0)) PEC_6800,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,45,IP.IMPORTE,0)) PEC_6900,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,46,IP.IMPORTE,0)) PEC_7000,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,47,IP.IMPORTE,0)) PEC_7020,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,48,IP.IMPORTE,0)) PEC_7100,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,49,IP.IMPORTE,0)) PEC_7110,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,50,IP.IMPORTE,0)) PEC_7200,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,708,IP.IMPORTE,0)) PEC_7201,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,51,IP.IMPORTE,0)) PEC_7210,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,709,IP.IMPORTE,0)) PEC_7211,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,53,IP.IMPORTE,0)) PEC_7240,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,55,IP.IMPORTE,0)) PEC_7301,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,710,IP.IMPORTE,0)) PEC_7312,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,58,IP.IMPORTE,0)) PEC_7510,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,713,IP.IMPORTE,0)) PEC_7511,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,59,IP.IMPORTE,0)) PEC_7520,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,714,IP.IMPORTE,0)) PEC_7521,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,62,IP.IMPORTE,0)) PEC_7801,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,63,IP.IMPORTE,0)) PEC_7802,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,719,IP.IMPORTE,0)) PEC_7805,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,66,IP.IMPORTE,0)) PEC_7900,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,67,IP.IMPORTE,0)) PEC_7901,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,69,IP.IMPORTE,0)) PEC_7903,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,720,IP.IMPORTE,0)) PEC_7904,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,70,IP.IMPORTE,0)) PEC_7905,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,71,IP.IMPORTE,0)) PEC_7906,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,722,IP.IMPORTE,0)) PEC_8100,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,723,IP.IMPORTE,0)) PEC_8200,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,74,IP.IMPORTE,0)) PEC_8800,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,174,IP.IMPORTE,0)) PEC_8801,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,77,IP.IMPORTE,0)) PEC_8808,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,78,IP.IMPORTE,0)) PEC_8812,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,80,IP.IMPORTE,0)) PEC_8830,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,180,IP.IMPORTE,0)) PEC_8831,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,82,IP.IMPORTE,0)) PEC_8833,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,87,IP.IMPORTE,0)) PEC_8850,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,738,IP.IMPORTE,0)) PEC_8853,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,756,IP.IMPORTE,0)) PEC_9111,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,742,IP.IMPORTE,0)) PEC_9200,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,743,IP.IMPORTE,0)) PEC_9210,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,746,IP.IMPORTE,0)) PEC_9320,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,92,IP.IMPORTE,0)) PEC_9410,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,95,IP.IMPORTE,0)) PEC_9510,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,96,IP.IMPORTE,0)) PEC_9511,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,97,IP.IMPORTE,0)) PEC_9520,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,98,IP.IMPORTE,0)) PEC_9521,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,100,IP.IMPORTE,0)) PEC_9610,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,101,IP.IMPORTE,0)) PEC_9620,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,103,IP.IMPORTE,0)) PEC_9710,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,747,IP.IMPORTE,0)) PEC_9711,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,748,IP.IMPORTE,0)) PEC_9721,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,1012,IP.IMPORTE,0)) PEC_1012R,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,1013,IP.IMPORTE,0)) PEC_1013R,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,1001,IP.IMPORTE,0)) PEC_1401R,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,1002,IP.IMPORTE,0)) PEC_1501R,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,1015,IP.IMPORTE,0)) PEC_2001R,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,30,IP.IMPORTE,0)) PEC_2310B,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,1019,IP.IMPORTE,0)) PEC_2901R,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,1021,IP.IMPORTE,0)) PEC_3601R,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,1023,IP.IMPORTE,0)) PEC_3701R,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,1024,IP.IMPORTE,0)) PEC_3721R,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,1026,IP.IMPORTE,0)) PEC_4401R,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,1028,IP.IMPORTE,0)) PEC_4501R,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,1031,IP.IMPORTE,0)) PEC_4901R,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,1032,IP.IMPORTE,0)) PEC_5101R,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,1033,IP.IMPORTE,0)) PEC_5201R,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,1035,IP.IMPORTE,0)) PEC_5301R,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,2331,IP.IMPORTE,0)) PEC_6540R,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,2332,IP.IMPORTE,0)) PEC_6541R,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,2333,IP.IMPORTE,0)) PEC_6542R,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,1044,IP.IMPORTE,0)) PEC_6801R,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,1046,IP.IMPORTE,0)) PEC_7001R,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,1047,IP.IMPORTE,0)) PEC_7021R,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,1048,IP.IMPORTE,0)) PEC_7101R,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,1049,IP.IMPORTE,0)) PEC_7111R,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,1050,IP.IMPORTE,0)) PEC_7202R,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,1051,IP.IMPORTE,0)) PEC_7212R,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,1059,IP.IMPORTE,0)) PEC_7520R,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,1063,IP.IMPORTE,0)) PEC_7804R,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,1074,IP.IMPORTE,0)) PEC_8801R,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,1087,IP.IMPORTE,0)) PEC_8809R,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,1077,IP.IMPORTE,0)) PEC_8813R,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,1078,IP.IMPORTE,0)) PEC_8831R,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,1080,IP.IMPORTE,0)) PEC_8834R,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,1082,IP.IMPORTE,0)) PEC_8851R,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,1999,IP.IMPORTE,0)) PEC_999RR,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,340,IP.IMPORTE,0)) DED_340,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,341,IP.IMPORTE,0)) DED_341,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,400,IP.IMPORTE,0)) DED_400,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,301,IP.IMPORTE,0)) DED_500,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,302,IP.IMPORTE,0)) DED_510,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,304,IP.IMPORTE,0)) DED_700,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,305,IP.IMPORTE,0)) DED_701,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,354,IP.IMPORTE,0)) DED_702,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,339,IP.IMPORTE,0)) DED_703,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,306,IP.IMPORTE,0)) DED_720,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,406,IP.IMPORTE,0)) DED_806,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,407,IP.IMPORTE,0)) DED_807,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,410,IP.IMPORTE,0)) DED_810,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,411,IP.IMPORTE,0)) DED_812,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,412,IP.IMPORTE,0)) DED_813,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,413,IP.IMPORTE,0)) DED_814,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,423,IP.IMPORTE,0)) DED_930,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,351,IP.IMPORTE,0)) DED_1000,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,352,IP.IMPORTE,0)) DED_1010,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,355,IP.IMPORTE,0)) DED_1020,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,356,IP.IMPORTE,0)) DED_1021,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,353,IP.IMPORTE,0)) DED_1040,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,308,IP.IMPORTE,0)) DED_1110,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,359,IP.IMPORTE,0)) DED_1410,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,360,IP.IMPORTE,0)) DED_1510,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,361,IP.IMPORTE,0)) DED_1604,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,362,IP.IMPORTE,0)) DED_1707,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,363,IP.IMPORTE,0)) DED_1934,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,366,IP.IMPORTE,0)) DED_2010,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,367,IP.IMPORTE,0)) DED_2230,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,369,IP.IMPORTE,0)) DED_2400,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,311,IP.IMPORTE,0)) DED_2510,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,370,IP.IMPORTE,0)) DED_2801,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,456,IP.IMPORTE,0)) DED_3901,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,313,IP.IMPORTE,0)) DED_4000,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,314,IP.IMPORTE,0)) DED_4010,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,373,IP.IMPORTE,0)) DED_4012,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,465,IP.IMPORTE,0)) DED_4300,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,322,IP.IMPORTE,0)) DED_4705,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,325,IP.IMPORTE,0)) DED_4708,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,326,IP.IMPORTE,0)) DED_4709,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,467,IP.IMPORTE,0)) DED_4712,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,328,IP.IMPORTE,0)) DED_4714,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,329,IP.IMPORTE,0)) DED_4715,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,330,IP.IMPORTE,0)) DED_4716,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,338,IP.IMPORTE,0)) DED_4730,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,475,IP.IMPORTE,0)) DED_5431,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,479,IP.IMPORTE,0)) DED_5436,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,484,IP.IMPORTE,0)) DED_5442,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,499,IP.IMPORTE,0)) DED_5496,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,501,IP.IMPORTE,0)) DED_5498,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,503,IP.IMPORTE,0)) DED_5501,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,512,IP.IMPORTE,0)) DED_5519,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,517,IP.IMPORTE,0)) DED_5528,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,331,IP.IMPORTE,0)) DED_5540,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,332,IP.IMPORTE,0)) DED_5541,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,333,IP.IMPORTE,0)) DED_5542,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,334,IP.IMPORTE,0)) DED_5545,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,531,IP.IMPORTE,0)) DED_5551,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,532,IP.IMPORTE,0)) DED_5565,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,558,IP.IMPORTE,0)) DED_5580,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,536,IP.IMPORTE,0)) DED_5671,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,556,IP.IMPORTE,0)) DED_5801,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,376,IP.IMPORTE,0)) DED_5910,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,381,IP.IMPORTE,0)) DED_7230,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,382,IP.IMPORTE,0)) DED_7241,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,335,IP.IMPORTE,0)) DED_7311,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,548,IP.IMPORTE,0)) DED_8900,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,350,IP.IMPORTE,0)) DED_9112,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,388,IP.IMPORTE,0)) DED_9900,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,389,IP.IMPORTE,0)) DED_9910,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,391,IP.IMPORTE,0)) DED_9912,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,392,IP.IMPORTE,0)) DED_9920,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,394,IP.IMPORTE,0)) DED_9922,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,395,IP.IMPORTE,0)) DED_9930,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,396,IP.IMPORTE,0)) DED_9931,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,399,IP.IMPORTE,0)) DED_9934,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,2002,IP.IMPORTE,0)) DED_1501R,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,2019,IP.IMPORTE,0)) DED_2901R,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,2023,IP.IMPORTE,0)) DED_3701R,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,2024,IP.IMPORTE,0)) DED_3721R,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,2026,IP.IMPORTE,0)) DED_4401R,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,2028,IP.IMPORTE,0)) DED_4501R,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,2032,IP.IMPORTE,0)) DED_5101R,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,1331,IP.IMPORTE,0)) DED_6540R,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,1332,IP.IMPORTE,0)) DED_6541R,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,1333,IP.IMPORTE,0)) DED_6542R,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,2044,IP.IMPORTE,0)) DED_6801R,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,2046,IP.IMPORTE,0)) DED_7001R,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,2063,IP.IMPORTE,0)) DED_7804R,\n" +
"       SUM(DECODE(IP.NO_CONCEPTO,2999,IP.IMPORTE,0)) DED_999RR,\n" +
"       'NOM'||lpad(ip.no_proceso,2,'0')||ip.ejercicio||'04' NUM_POL_EGRE,\n" +
"       '"+poliza+"' NUM_POL_PRES, -- VALIDAR CON SIIA\n" +
"       NULL NUM_CLC,\n" +
"       NULL ADIC_TEXTO_N,\n" +
"       ip.no_parametro no_parametro,\n" +
"       IP.NO_GRUPO NO_GRUPO,\n" +
"       IP.NO_PROCESO NO_PROCESO,\n" +
"       IP.EJERCICIO EJERCICIO\n" +
"  from RH_UAEMEX.UAEM_POLIZA_DESGLOSES ip,\n" +
"       POSICIONES_ORGANIZACIONALES PO,\n" +
"       CONCILIACIONES_BANCARIAS CB,\n" +
"       AREAS_FUNCIONALES AF,\n" +
"       PERSONAL PE,\n" +
"       conceptos co,\n" +
"       PUESTOS PU,\n" +
"       MODELOS MO,\n" +
"       procesos_de_nomina pn\n" +
" where co.no_concepto = ip.no_concepto\n" +
"   and ip.ejercicio = pn.ejercicio\n" +
"   AND PO.NO_POSICION = IP.NO_POSICION\n" +
"   AND PO.NO_PUESTO = PU.NO_PUESTO\n" +
"   AND PU.NO_TIPO_PUESTO = MO.NO_MODELO\n" +
"   AND CB.NO_PERSONAL = IP.NO_PERSONAL\n" +
"   AND CB.NO_PROCESO = IP.NO_PROCESO\n" +
"   AND CB.EJERCICIO = IP.EJERCICIO\n" +
"   AND IP.NO_PARAMETRO = CB.NO_PARAMETRO\n" +
"   AND IP.NO_GRUPO  = CB.NO_GRUPO\n" +
"   AND CB.NO_CONSECUTIVO IS NULL\n" +
"   AND IP.TIPO_POLIZA = 'N'\n" +
"   AND PO.CLAVE_AREA = AF.CLAVE_AREA -- VALIDAR SI SERA AREA FUNCIONAL O AREA CONTABLE\n" +
"   AND PE.NO_PERSONAL = PO.NO_PERSONAL \n" +
"   AND PE.NO_PERSONAL = IP.NO_PERSONAL \n" +
"   AND PO.NO_PERSONAL = IP.NO_PERSONAL\n" +
"   and ip.no_proceso = pn.no_proceso\n" +
"   and ip.no_parametro = pn.no_parametro \n" +
"   and co.modo in ('PEC','DED')\n" +
"   AND IP.NO_PROCESO = "+qna+"\n" +
"   and ip.ejercicio = 2024\n" +
"   and ip.no_parametro !=3\n" +
"  -- AND IP.NO_PERSONAL IN (26593,27257,28798,28631,30438,31153,31362,26986,27555,34027,32576,32581,32583,34494,34318,40925,42043,42228,35914,35917,35919,35921,35924,37671,35912,37642,18660,522,25280,11769,14771,16037,20584,16066,16069,6316,12337,21870,16626,23798,20171,20173)\n" +
"   AND IP.CLAVE_CUENTA_CONTABLE NOT LIKE '1112%'\n" +
"GROUP BY DECODE(IP.NO_FUENTE,1163,'U006',1164,'EST','PARTICIPACIONES'),AF.CLAVE_AREA,af.descripcion,DECODE(IP.NO_PARAMETRO,3,'H','O'),\n" +
"         PE.APELLIDO_PATERNO,pe.apellido_materno,PE.NOMBRE,PE.NO_PERSONAL,IP.NO_POSICION,MO.DESCRIPCION,PO.NO_PUESTO,\n" +
"         po.horas_trabajo,PE.FECHA_ANTIGUEDAD,PN.FECHA_FIN_NOMINA,PN.FECHA_INICIO_NOMINA,lpad(ip.no_proceso,2,'0'),ip.ejercicio,pn.FECHA_PAGO,\n" +
"         DECODE(CB.TIPO_DE_PAGO,2,'EL','CH'), CB.NO_CHEQUE, CB.NO_CUENTA_ORG,DECODE(CB.NO_BANCO,1,'SANTANDER',2,'BANAMEX',3,'BANORTE','OTRO'),PO.NO_POSICION,CB.NO_CUENTA,\n" +
"         IP.NO_FUENTE,CB.UUID,IP.no_parametro,IP.NO_GRUPO,IP.NO_PROCESO,pe.afiliacion,pu.nombre,decode(ip.no_proceso,4,14,15),DECODE(CB.NO_BANCO,1,'014',2,'002',3,'072','OTRO')\n" +
"   ORDER BY pE.no_personal";
        return query;
    }
    
    public List<String> ejecutarQueryYGenerarInserts(String querySql) throws SQLException {
        try {
inserts = new ArrayList<>();
SimpleDateFormat dateFormat = new SimpleDateFormat("yyyy-MM-dd");
System.out.println(querySql);
conexionOrigen = new ConexionWeb();
conexion = conexionOrigen.getConexion();
stm =  conexion.createStatement(); 
rs = stm.executeQuery(querySql);

// Procesar cada fila del ResultSet
while (rs.next()) {
StringBuilder insertBuilder = new StringBuilder();
insertBuilder.append("INSERT INTO NOMINA_ORDINARIA_2024 VALUES (");

// Procesar cada columna en el orden exacto de la tabla
// ENTIDAD (VARCHAR2)
appendStringValue(insertBuilder, rs.getString("ENTIDAD"));

// NOM_FONDO (VARCHAR2)
appendStringValue(insertBuilder, rs.getString("NOM_FONDO"));

// CLAVE_DEPEN (VARCHAR2)
appendStringValue(insertBuilder, rs.getString("CLAVE_DEPEN"));

// DEPEN (VARCHAR2)
appendStringValue(insertBuilder, rs.getString("DEPEN"));

// CCT (VARCHAR2)
appendStringValue(insertBuilder, rs.getString("CCT"));

// CENTRO_TRABAJO (VARCHAR2)
appendStringValue(insertBuilder, rs.getString("CENTRO_TRABAJO"));

// TIPONOMINA (VARCHAR2)
appendStringValue(insertBuilder, rs.getString("TIPONOMINA"));

// PERIODICIDAD_PAGO (VARCHAR2)
appendStringValue(insertBuilder, rs.getString("PERIODICIDAD_PAGO"));

// RFC (VARCHAR2)
appendStringValue(insertBuilder, rs.getString("RFC"));

// CURP (VARCHAR2)
appendStringValue(insertBuilder, rs.getString("CURP"));

// NSS (VARCHAR2)
appendStringValue(insertBuilder, rs.getString("NSS"));

// NOMBRE_EMP (VARCHAR2)
appendStringValue(insertBuilder, rs.getString("NOMBRE_EMP"));

// APELLIDO_1_EMP (VARCHAR2)
appendStringValue(insertBuilder, rs.getString("APELLIDO_1_EMP"));

// APELLIDO_2_EMP (VARCHAR2)
appendStringValue(insertBuilder, rs.getString("APELLIDO_2_EMP"));

// NUM_EMP (NUMBER)
appendNumberValue(insertBuilder, rs.getBigDecimal("NUM_EMP"));

// PLAZA (NUMBER)
appendNumberValue(insertBuilder, rs.getBigDecimal("PLAZA"));

// TIPO_DE_PERSONAL (VARCHAR2)
appendStringValue(insertBuilder, rs.getString("TIPO_DE_PERSONAL"));

// CAT_PUESTO (VARCHAR2)
appendStringValue(insertBuilder, rs.getString("CAT_PUESTO"));

// CATEGORIA (VARCHAR2)
appendStringValue(insertBuilder, rs.getString("CATEGORIA"));

// DES_PUESTO (VARCHAR2)
appendStringValue(insertBuilder, rs.getString("DES_PUESTO"));

// NIVEL_SALARIAL (VARCHAR2)
appendStringValue(insertBuilder, rs.getString("NIVEL_SALARIAL"));

// ZE (VARCHAR2)
appendStringValue(insertBuilder, rs.getString("ZE"));

// HORAS (NUMBER)
appendNumberValue(insertBuilder, rs.getBigDecimal("HORAS"));

// FECHA_ING (DATE)
appendDateValue(insertBuilder, rs.getDate("FECHA_ING"), dateFormat);

// ANTIG (VARCHAR2)
appendStringValue(insertBuilder, rs.getString("ANTIG"));

// N_QUINQ (NUMBER)
appendNumberValue(insertBuilder, rs.getBigDecimal("N_QUINQ"));

// FECHA_INI (DATE)
appendDateValue(insertBuilder, rs.getDate("FECHA_INI"), dateFormat);

// FECHA_FIN (DATE)
appendDateValue(insertBuilder, rs.getDate("FECHA_FIN"), dateFormat);

// FECHA_PROC (DATE)
appendDateValue(insertBuilder, rs.getDate("FECHA_PROC"), dateFormat);

// PERIODO_INI (NUMBER)
appendNumberValue(insertBuilder, rs.getBigDecimal("PERIODO_INI"));

// PERIODO_FIN (NUMBER)
appendNumberValue(insertBuilder, rs.getBigDecimal("PERIODO_FIN"));

// PERIODO_PROC (NUMBER)
appendNumberValue(insertBuilder, rs.getBigDecimal("PERIODO_PROC"));

// DIAS_PAG (NUMBER)
appendNumberValue(insertBuilder, rs.getBigDecimal("DIAS_PAG"));

// TIPO_PAGO (VARCHAR2)
appendStringValue(insertBuilder, rs.getString("TIPO_PAGO"));

// NUM_CHEQUE_TRANSF (NUMBER)
appendNumberValue(insertBuilder, rs.getBigDecimal("NUM_CHEQUE_TRANSF"));

// NUM_CTA_PAG (VARCHAR2)
appendStringValue(insertBuilder, rs.getString("NUM_CTA_PAG"));

// CVE_BANCO_PAG (VARCHAR2)
appendStringValue(insertBuilder, rs.getString("CVE_BANCO_PAG"));

// NOM_BANCO_PAG (VARCHAR2)
appendStringValue(insertBuilder, rs.getString("NOM_BANCO_PAG"));

// NUM_CTA_EMP (VARCHAR2)
appendStringValue(insertBuilder, rs.getString("NUM_CTA_EMP"));

// CVE_BANCO_EMP (VARCHAR2)
appendStringValue(insertBuilder, rs.getString("CVE_BANCO_EMP"));

// NOM_BANCO_EMP (VARCHAR2)
appendStringValue(insertBuilder, rs.getString("NOM_BANCO_EMP"));

// ORIGEN_RECURSO (VARCHAR2)
appendStringValue(insertBuilder, rs.getString("ORIGEN_RECURSO"));

// UUID (VARCHAR2)
appendStringValue(insertBuilder, rs.getString("UUID"));

// T_PERCCHEQ (NUMBER)
appendNumberValue(insertBuilder, rs.getBigDecimal("T_PERCCHEQ"));

// T_DEDCHEQ (NUMBER)
appendNumberValue(insertBuilder, rs.getBigDecimal("T_DEDCHEQ"));

// T_NETOCHEQ (NUMBER)
appendNumberValue(insertBuilder, rs.getBigDecimal("T_NETOCHEQ"));

// Todos los campos PEC_XXXX (NUMBER)
for (int i = 101; i <= 9999; i++) {
String colName = "PEC_" + i;
if (hasColumn(rs, colName)) {
appendNumberValue(insertBuilder, rs.getBigDecimal(colName));
}
}

// Todos los campos PEC_XXXXR (NUMBER)
for (int i = 1012; i <= 9999; i++) {
String colName = "PEC_" + i + "R";
if (hasColumn(rs, colName)) {
appendNumberValue(insertBuilder, rs.getBigDecimal(colName));
}
}

// Todos los campos DED_XXXX (NUMBER)
for (int i = 340; i <= 9999; i++) {
String colName = "DED_" + i;
if (hasColumn(rs, colName)) {
appendNumberValue(insertBuilder, rs.getBigDecimal(colName));
}
}

// Todos los campos DED_XXXXR (NUMBER)
for (int i = 1501; i <= 9999; i++) {
String colName = "DED_" + i + "R";
if (hasColumn(rs, colName)) {
appendNumberValue(insertBuilder, rs.getBigDecimal(colName));
}
}

// NUM_POL_EGRE (VARCHAR2)
appendStringValue(insertBuilder, rs.getString("NUM_POL_EGRE"));

// NUM_POL_PRES (VARCHAR2)
appendStringValue(insertBuilder, rs.getString("NUM_POL_PRES"));

// NUM_CLC (VARCHAR2)
appendStringValue(insertBuilder, rs.getString("NUM_CLC"));

// ADIC_TEXTO_N (VARCHAR2)
appendStringValue(insertBuilder, rs.getString("ADIC_TEXTO_N"));

// NO_PARAMETRO (NUMBER)
appendNumberValue(insertBuilder, rs.getBigDecimal("NO_PARAMETRO"));

// NO_GRUPO (NUMBER)
appendNumberValue(insertBuilder, rs.getBigDecimal("NO_GRUPO"));

// NO_PROCESO (NUMBER)
appendNumberValue(insertBuilder, rs.getBigDecimal("NO_PROCESO"));

// EJERCICIO (NUMBER)
appendNumberValue(insertBuilder, rs.getBigDecimal("EJERCICIO"));

if (insertBuilder.charAt(insertBuilder.length() - 1) == ',') {
insertBuilder.deleteCharAt(insertBuilder.length() - 1);
}

insertBuilder.append(")");
inserts.add(insertBuilder.toString());
}
        } catch (ClassNotFoundException ex) {
            Logger.getLogger(WebaCliente.class.getName()).log(Level.SEVERE, null, ex);
        }
        
        return inserts;
    }
     
     
     private void appendStringValue(StringBuilder builder, String value) {
        if (value == null) {
            builder.append("NULL,");
        } else {
            builder.append("'").append(value.replace("'", "''")).append("',");
        }
    }

    private void appendNumberValue(StringBuilder builder, BigDecimal value) {
        if (value == null) {
            builder.append("NULL,");
        } else {
            builder.append(value).append(",");
        }
    }

    private void appendDateValue(StringBuilder builder, Date value, SimpleDateFormat dateFormat) {
        if (value == null) {
            builder.append("NULL,");
        } else {
            builder.append("TO_DATE('")
                  .append(dateFormat.format(value))
                  .append("', 'YYYY-MM-DD'),");
        }
    }

    // Método para verificar si una columna existe en el ResultSet
    private boolean hasColumn(ResultSet rs, String columnName) {
        try {
            rs.findColumn(columnName);
            return true;
        } catch (SQLException e) {
            return false;
        }
    }
  // Método para ejecutar los inserts en la base de datos destino
    public void ejecutarInserts(List<String> inserts) throws SQLException {
        Statement stmt = null;
        try {
            stmt = conexionDestino.getConexion().createStatement();
            
            // Ejecutar en lotes para mejor rendimiento
            int batchSize = 0;
            final int MAX_BATCH_SIZE = 100; // Ajusta según necesidades
            
            for (String insert : inserts) {
                System.out.println(insert);
                stmt.addBatch(insert);
                batchSize++;
         
                if (batchSize % MAX_BATCH_SIZE == 0) {
                    stmt.executeBatch();
                    stmt.clearBatch();
                }
            }
            
            // Ejecutar los restantes
            if (batchSize % MAX_BATCH_SIZE != 0) {
                stmt.executeBatch();
            }
        } finally {
            if (stmt != null) {
                try {
                    stmt.close();
                } catch (SQLException e) {
                    e.printStackTrace();
                }
            }
        }
    }

}
